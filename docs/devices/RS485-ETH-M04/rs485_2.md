好的 👍 我会把 RS485-ETH-M04 的汇总文档细化成一个 开发接口文档，包括：输入输出格式、报文示例、端口号分配、协议映射逻辑，程序员照着就能直接写代码对接。

⸻

RS485-ETH-M04 开发接口文档

1. 网络与串口配置
	•	默认 IP：192.168.1.12
	•	默认登录：用户名/密码 = amx666
	•	串口默认参数：9600, 8 数据位, 无校验, 1 停止位
	•	支持波特率：1200 ~ 115200
	•	缓冲区：1024 字节

⸻

2. 模式与端口映射

模式	TCP 端口	网口角色	串口角色	备注
MODBUS TCP → RTU 通用	502~505	TCP Server	RTU 从站	站号映射 = RTU 从站号
MODBUS TCP → RTU 主站	5502	TCP Server	RTU 从站	仅 HC0 支持，自动轮询 1~6 号
MODBUS RTU → TCP	自定义（默认 502）	TCP Client	RTU 主站	模块主动连接远端 Server
Server 透传	8801~8804	TCP Server	RS485 设备	单纯透传
普通 Client 透传	自定义（默认 502）	TCP Client	RS485 设备	主动连接 TCP Server
自定义 Client 透传	自定义	TCP Client	RS485 设备	支持报文头/尾 + 心跳包
AIOT 透传	6666（远端）	TCP Client	RS485 设备	连接艾莫迅云
MODBUS TCP → RTU 高级	502~505	TCP Server	RTU 从站	自动计算站号，无需修改 TCP 报文


⸻

3. 报文格式

3.1 MODBUS TCP 报文格式

+-----------------+----------------+---------------+---------------+----------------+----------------+
| Transaction ID  | Protocol ID(0) | Length (2B)   | Unit ID (1B)  | Function Code  | Data           |
+-----------------+----------------+---------------+---------------+----------------+----------------+

	•	Unit ID = RTU 从站地址（在通用模式下直接映射；在主站/高级模式下由模块自动计算）。

3.2 MODBUS RTU 报文格式

+--------------+----------------+----------------+---------------+
| Slave Addr   | Function Code  | Data           | CRC16 (2B)    |
+--------------+----------------+----------------+---------------+


⸻

4. 模式实现逻辑

4.1 MODBUS TCP → RTU 通用

输入（TCP Client → 模块）：

00 01 00 00 00 06 01 03 00 00 00 0A

解释：Transaction=0x0001, 协议=0, 长度=6, 单元ID=1, 功能码=03, 起始寄存器=0, 数量=10。

输出（模块 → RTU 从站）：

01 03 00 00 00 0A C5 CD

（CRC16 自动计算）。

返回路径： RTU 从站应答 → 模块 → 封装 TCP → 返回 Client。

⸻

4.2 MODBUS TCP → RTU 主站
	•	模块主动轮询 1~6 号从站，并将寄存器映射到 TCP 地址空间。
	•	TCP Client 不需要关心从站号。

示例
TCP Client 请求：

00 01 00 00 00 06 01 03 00 00 00 08

解释：请求保持寄存器 8 个。
模块会自动拆分并访问 RS485 总线对应的从站。

⸻

4.3 MODBUS RTU → TCP

输入（RTU 主站 → 模块）：

01 03 00 00 00 0A C5 CD

输出（模块 → TCP Server）：

00 01 00 00 00 06 01 03 00 00 00 0A


⸻

4.4 自定义 Client 透传

输入串口数据：

41 42 43 44   ; (数据 "ABCD")

模块加报文头/尾（如 #### = 23 23 23 23）：
输出 TCP 报文：

23 23 23 23 41 42 43 44 23 23 23 23

心跳包：每 60 秒自动发送一次（最大 50 字节）。
示例配置：www.amsamotion.com → 7777772E616D73616D6F74696F6E2E636F6D

⸻

5. 错误与恢复
	•	连接异常：自动重连（Client 模式）
	•	报文异常：丢弃无效数据
	•	复位：上电 30 秒内长按 Reset，恢复默认（IP=192.168.1.12，账号密码=amx666）

⸻

6. 实现建议
	1.	TCP 层：实现多端口监听（502, 503, 504, 505, 8801~8804, 5502）。
	2.	报文解析层：识别 TCP/RTU 格式并转换。
	3.	心跳机制：自定义 Client 模式下，固定 60 秒发送心跳。
	4.	寄存器映射：在主站/高级模式下，需维护站号与寄存器偏移表。

⸻

