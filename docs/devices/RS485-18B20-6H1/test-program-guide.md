# KLT-18B20-6H1 温度传感器测试程序使用指南

## 📋 **程序概述**

本测试程序专为KLT-18B20-6H1六路温度传感器设计，基于Modbus-RTU协议，支持RS485通信。提供完整的设备测试、监控和管理功能。

### **程序文件**
- `klt-18b20-6h1-test.js` - 完整功能测试程序
- `quick-temperature-test.js` - 快速温度读取工具
- `test-program-guide.md` - 使用指南 (本文档)

## 🔧 **设备规格**

### **KLT-18B20-6H1 技术参数**
- **通道数量**: 6路温度传感器
- **温度精度**: ±0.3°C (25°C时)
- **测量范围**: -55°C ~ +125°C
- **分辨率**: 0.1°C
- **通信协议**: Modbus-RTU over RS485
- **默认地址**: 0x01
- **默认波特率**: 9600 bps, 8N1

### **寄存器映射**
| 地址 | 功能 | 说明 |
|------|------|------|
| 0x0000 | 温度通道1 | 温度值×10 |
| 0x0001 | 温度通道2 | 温度值×10 |
| 0x0002 | 温度通道3 | 温度值×10 |
| 0x0003 | 温度通道4 | 温度值×10 |
| 0x0004 | 温度通道5 | 温度值×10 |
| 0x0005 | 温度通道6 | 温度值×10 |
| 0x0010 | 设备类型 | 19 (KLT-18B20-6H1) |
| 0x0011 | 设备地址 | 1-255 |
| 0x0012 | 波特率设置 | 0-8 |
| 0x0013 | CRC字节序 | 0/1 |
| 0x0020 | 温度校准 | 校准值×10 |

## 🚀 **快速开始**

### **1. 快速温度读取**
```bash
# 基本用法 (默认: 192.168.110.50:502, 站号1)
node quick-temperature-test.js

# 指定参数
node quick-temperature-test.js 192.168.110.50 502 1 single

# 连续读取5次，间隔3秒
node quick-temperature-test.js 192.168.110.50 502 1 continuous 5 3

# 设备健康检查
node quick-temperature-test.js 192.168.110.50 502 1 health
```

### **2. 完整功能测试**
```bash
# 快速测试
node klt-18b20-6h1-test.js 192.168.110.50 502 1 quick

# 完整测试
node klt-18b20-6h1-test.js 192.168.110.50 502 1 full

# 连接诊断
node klt-18b20-6h1-test.js 192.168.110.50 502 1 diagnose
```

## 🧪 **测试模式详解**

### **快速测试模式 (quick)**
```bash
node klt-18b20-6h1-test.js 192.168.110.50 502 1 quick
```
- ✅ 读取6路温度数据
- ✅ 显示温度统计信息
- ✅ 检测开路传感器
- ⏱️ 执行时间: ~10-15秒

### **完整测试模式 (full)**
```bash
node klt-18b20-6h1-test.js 192.168.110.50 502 1 full
```
- ✅ 连接诊断
- ✅ 设备信息读取
- ✅ 6路温度完整读取
- ✅ 设备配置验证
- ⏱️ 执行时间: ~30-45秒

### **实时监控模式 (monitor)**
```bash
# 监控30秒间隔，持续300秒 (5分钟)
node klt-18b20-6h1-test.js 192.168.110.50 502 1 monitor 30 300

# 监控10秒间隔，持续600秒 (10分钟)
node klt-18b20-6h1-test.js 192.168.110.50 502 1 monitor 10 600
```
- ✅ 实时温度监控
- ✅ 温度趋势分析
- ✅ 数据自动保存
- ✅ 监控报告生成

### **设备配置模式 (config)**
```bash
# 查看当前配置
node klt-18b20-6h1-test.js 192.168.110.50 502 1 config

# 修改设备地址为2
node klt-18b20-6h1-test.js 192.168.110.50 502 1 config 2

# 修改波特率为19200 (设置值5)
node klt-18b20-6h1-test.js 192.168.110.50 502 1 config null 5

# 修改CRC字节序为低字节在前
node klt-18b20-6h1-test.js 192.168.110.50 502 1 config null null 1
```

**波特率设置值对照表**:
| 设置值 | 波特率 |
|--------|--------|
| 0 | 300 |
| 1 | 1200 |
| 2 | 2400 |
| 3 | 4800 |
| 4 | 9600 (默认) |
| 5 | 19200 |
| 6 | 38400 |
| 7 | 57600 |
| 8 | 115200 |

### **设备扫描模式 (scan)**
```bash
# 扫描地址1-10
node klt-18b20-6h1-test.js 192.168.110.50 502 1 scan 1 10

# 扫描地址1-50
node klt-18b20-6h1-test.js 192.168.110.50 502 1 scan 1 50
```
- ✅ 自动发现KLT-18B20-6H1设备
- ✅ 显示设备配置信息
- ✅ 提供批量管理建议

### **批量管理模式 (batch)**
```bash
# 自动扫描并批量管理
node klt-18b20-6h1-test.js 192.168.110.50 502 1 batch auto

# 使用预定义设备列表
node klt-18b20-6h1-test.js 192.168.110.50 502 1 batch
```
- ✅ 批量健康检查
- ✅ 批量温度读取
- ✅ 多设备统一管理

### **连接诊断模式 (diagnose)**
```bash
node klt-18b20-6h1-test.js 192.168.110.50 502 1 diagnose
```
- ✅ 设备连接测试
- ✅ 设备类型验证
- ✅ 温度读取测试
- ✅ 响应时间测量

## 📊 **输出示例**

### **快速温度读取输出**
```
🌡️ 读取6路温度传感器数据...
============================================================
  ✅ 通道1: 23.5°C
  ✅ 通道2: 24.1°C
  ✅ 通道3: 22.8°C
  ⚠️ 通道4: 开路
  ✅ 通道5: 25.2°C
  ✅ 通道6: 23.9°C

📊 温度统计:
  正常读取: 5/6
  传感器开路: 1/6
  读取错误: 0/6
  温度范围: 22.8°C ~ 25.2°C
  平均温度: 23.9°C
```

### **设备信息输出**
```
📋 读取设备信息...
----------------------------------------
  设备类型: 19 (KLT-18B20-6H1)
  设备地址: 1
  波特率: 9600 bps (设置值: 4)
  CRC字节序: 高字节在前 (0)
  温度校准: 0.0°C
```

### **监控数据输出**
```
📊 监控数据 #1 - 2025/9/11 08:30:15
--------------------------------------------------
  ✅ 通道1: 23.5°C
  ✅ 通道2: 24.1°C
  ✅ 通道3: 22.8°C
  ⚠️ 通道4: 开路
  ✅ 通道5: 25.2°C
  ✅ 通道6: 23.9°C

📈 温度趋势:
  通道1: 23.5°C ➡️ (+0.0°C)
  通道2: 24.1°C ↗️ (+0.2°C)
  通道3: 22.8°C ↘️ (-0.1°C)
  通道5: 25.2°C ➡️ (+0.0°C)
  通道6: 23.9°C ↗️ (+0.1°C)
```

## ⚠️ **注意事项**

### **硬件连接**
1. **电源**: 5-30V DC，注意极性
2. **RS485**: 黄线(A+)，绿/白线(B-)
3. **终端电阻**: 多设备时需要120Ω终端电阻
4. **接地**: 确保良好的接地连接

### **软件配置**
1. **网关设置**: 确保RS485-ETH-M04网关配置正确
2. **端口映射**: 确认TCP端口与物理接口的映射关系
3. **波特率匹配**: 网关和设备波特率必须一致
4. **地址冲突**: 避免多设备使用相同地址

### **故障排除**
1. **连接失败**: 检查网关IP、端口、设备地址
2. **读取超时**: 检查RS485连接线路
3. **数据异常**: 检查波特率和CRC设置
4. **开路检测**: -1850值表示传感器开路

## 🔧 **高级功能**

### **数据记录**
监控模式会自动生成JSON格式的数据文件：
```json
{
  "metadata": {
    "device": "KLT-18B20-6H1",
    "startTime": "2025-09-11T08:30:00.000Z",
    "duration": 300,
    "interval": 30
  },
  "data": [...],
  "report": {...}
}
```

### **批量设备管理**
支持多设备统一管理，自动生成设备列表和健康报告。

### **实时监控**
提供温度趋势分析、异常检测和自动报警功能。

---

**程序版本**: v1.0  
**更新日期**: 2025-09-11  
**适用设备**: KLT-18B20-6H1 六路温度传感器  
**通信协议**: Modbus-RTU over RS485
