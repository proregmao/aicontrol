# CX-IR002E 开发文档

**版本：V1.0**  
**日期：2025-09-09**  
**文档概述**：本文档基于提供的通信协议文档（CX-IR002E W-通信协议_V1.0.docx）和产品使用手册（CX-IR002E红外产品使用手册_V1.0.pdf），整理出CX-IR002E设备的完整开发指南。包括产品参数、硬件接口、功能配置、通信协议、调试示例、代码示例等，适用于二次开发和软件集成。其他程序员可根据本文档开发控制软件、APP或集成系统，支持红外控制（如空调、电视等）、网络通信（TCP/UDP/MQTT）和模拟量采集。文档设计为自包含式，便于实现设备控制逻辑。

## 目录

一、产品概述............................................................................................................................ 2  
1.1 基本参数表.........................................................................................................................2  
1.2 产品尺寸（单位：毫米）................................................................................................. 2  

二、硬件接口与指示图.............................................................................................................. 3  

三、功能详解与配置.................................................................................................................. 4  
3.1 AP 对码............................................................................................................................... 4  
3.2 网络参数配置......................................................................................................................5  
3.2.1 连接路由器/交换机方式..........................................................................................5  
3.2.2 直接连接电脑方式.................................................................................................. 6  
3.3 调试软件测试......................................................................................................................9  
3.3.1 空调发指令一键对码.............................................................................................. 9  
3.3.2 空调填写码库对码................................................................................................11  
3.3.3 红外学习............................................................................................................... 12  
3.4 TCP 服务器模式下--调试................................................................................................13  
3.5 TCP 客户端模式下--调试................................................................................................14  
3.6 UDP 模式下--调试.......................................................................................................... 16  
3.7 MQTT 模式下--调试....................................................................................................... 19  
3.7.1 IP 配置方式........................................................................................................... 19  
3.7.2 MQTT 参数配置................................................................................................... 19  
3.7.3 配置示例............................................................................................................... 20  
3.7.4 测试平台测试....................................................................................................... 21  

四、通信协议详解...................................................................................................................... 22  
4.1 设备上传或回复数据格式..............................................................................................22  
4.2 下发数据格式....................................................................................................................23  
4.3 红外操作指令示例..........................................................................................................24  
4.4 Modbus-RTU 协议概述..................................................................................................26  
4.5 功能码寄存器表................................................................................................................27  
4.6 附件：设备对应关系、品牌代码号、按键表..................................................................30  

五、软件开发指南与代码示例...............................................................................................31  
5.1 开发环境准备..................................................................................................................31  
5.2 网络通信实现（TCP/UDP/MQTT）.............................................................................31  
5.3 红外控制代码示例（Python）......................................................................................32  
5.4 Modbus 集成示例............................................................................................................34  
5.5 错误处理与调试..............................................................................................................35  

六、开发注意事项与工具..........................................................................................................36  

## 一、产品概述

CX-IR002E 是一款工业级红外控制设备，支持红外学习、发射、空调/电视/机顶盒码库匹配，以及模拟量采集。适用于智能家居、工业自动化场景，通过网口或RS485通信。设备集成4路红外输出，支持Modbus-RTU协议和JSON格式指令。

### 1.1 基本参数表

| 参数          | 描述                                                                 |
|---------------|----------------------------------------------------------------------|
| 产品型号     | CX-IR002E                                                            |
| 二次开发     | 支持（提供协议和工具）                                               |
| 供电电压     | DC9-26V                                                              |
| 工作温度     | 工业级 -40~80℃                                                       |
| 通信接口     | 网口（10M/100M），集成RS485                                         |
| 尺寸大小     | 108mm × 72mm × 59mm (长×宽×高)                                      |
| 安装方式     | 固定耳朵/导轨配件                                                    |
| 通信协议     | TCP、UDP、MQTT、Modbus-RTU                                          |
| 其他功能     | 4路红外输出（可定制接口）；模拟量采集（C01-C04自带，C51-C78扩展）；互感器开关检测 |

### 1.2 产品尺寸（单位：毫米）

- 长：108mm  
- 宽：72mm  
- 高：59mm  

设备外观为导轨式，支持壁挂或DIN导轨安装。红外发射头可外接，支持多路（OUT1-4）同时发送。

## 二、硬件接口与指示图

设备正面接口：  
- 电源：DC+、DC-（DC9-26V输入）。  
- RS485：A、B（支持Modbus-RTU，默认地址1，波特率9600）。  
- 网口：LAN（RJ45，10/100M自适应）。  
- 红外输出：OUT1~OUT4（4路红外发射，紫色端子）；IR IN（红外接收，用于学习）。  
- 模拟量输入：C01~C04（自带4路，支持4-20mA电流或电压采集）；扩展支持C51~C78。  
- 指示灯：PWR（电源绿灯）、LINK（网口连接黄灯，常亮+闪烁正常）、IR（红外学习/发送红灯）、RUN（运行绿灯）。  

接口指示图（基于手册第3页）：  
- 上部：电源和RS485（绿色端子块）。  
- 中部：网口（RJ45）和红外输出（OUT1-4）。  
- 下部：模拟量采集（C01-C04，蓝色端子）；互感器连接AD管脚检测开关机（阈值配置单位10mV）。  
- 红外接收头位于正面，支持学习模式下遥控器对准（距离<10cm）。  

注意：ADIN/RS485管脚可复用（寄存器001EH配置）；支持蓝牙房间编号（001DH寄存器）。

## 三、功能详解与配置

### 3.1 AP 对码

设备支持AP模式用于初始配置或红外匹配（手册第4页）。  
步骤：  
1. 上电后，按AP按钮（或短接引脚），设备进入AP模式，广播WiFi热点（SSID: CX-IR002E_XXXX，适用于WiFi版本；网口版通过软件）。  
2. 手机/电脑连接热点，浏览器访问192.168.4.1。  
3. 配置网络或对码：遥控器对准IR接收头，按电源键。设备自动匹配码库。  
4. 成功回复码号（例：空调0x004F），保存退出。  

### 3.2 网络参数配置

配置软件下载链接：网络参数配置软件全兼容（手册提供）。  

#### 3.2.1 连接路由器/交换机方式

1. 网线连接设备到路由器/交换机，上电（LINK灯常亮+闪烁正常）。  
2. 打开软件，选择广播网卡（设备局域网网卡）。  
3. IP方式：静态IP（设置IP、掩码、网关）或DHCP（自动）。  
4. 工作模式：TCP服务器（单/多链接）、TCP客户端、UDP服务器/客户端、MQTT。  
5. 写入参数保存，重启设备。  

示例：静态IP 192.168.0.100，掩码255.255.255.0，网关192.168.0.1，端口5000。

#### 3.2.2 直接连接电脑方式

1. 网线直连电脑，上电（若灯不亮，加交换机）。  
2. 修改电脑网卡IP：192.168.0.X（X≠设备IP），掩码255.255.255.0。  
3. 打开软件，选择网卡，配置同上。  
4. 支持读取参数验证。  

工作模式表（手册第8页）：  

| 工作模式           | 功能描述                                      | 调试详解 |
|--------------------|-----------------------------------------------|----------|
| TCP 单链接服务器  | 作为服务器，支持1客户端连接                  | 见3.4   |
| TCP 多链接服务器  | 作为服务器，支持最多4客户端连接              | 见3.4   |
| TCP 客户端         | 作为客户端连接服务器                          | 见3.5   |
| UDP 服务端         | UDP，回复到发送方IP/端口                     | 见3.6   |
| UDP 客户端         | UDP，回复到指定远程IP/端口                   | 见3.6   |
| 自建MQTT对接      | 对接自定义MQTT服务器                          | 见3.7   |

IP配置表：  

| 配置名称   | 释义                                         |
|------------|----------------------------------------------|
| 本地IP    | 设备IP                                       |
| 子网掩码  | 局域网掩码                                   |
| 网关地址  | 局域网网关                                   |
| 远程IP    | 目标服务器IP（客户端模式）                   |
| 端口号    | 设备/服务器端口                             |

### 3.3 调试软件测试

调试软件：CX-IR002 调试软件（手册提供链接）。前提：TCP服务器模式。  

#### 3.3.1 空调发指令一键对码

1. 连接设备，点击“启动空调匹配”。  
2. 遥控器对准IR头，按空调电源键。  
3. 成功后控制空调（例：18℃指令{"irout0h":"010600260002E9C0","res":"123"}）。  

#### 3.3.2 空调填写码库对码

1. 从码库Excel（附件3）查找品牌码（例：格力740）。  
2. 填写码值测试，空调响应即成功。  

#### 3.3.3 红外学习

1. 点击“开始红外学习”（通道0-63）。  
2. IR灯闪烁，遥控器按键（例：风扇开关）。  
3. 测试学习，验证响应。支持波形读写（寄存器0500H-1180H）。  

### 3.4 TCP 服务器模式下--调试

助手：TCP 调试助手（手册链接）。  
协议：见四。  
示例：学习指令{"irout0h":"010600160001A9CE","res":"123"}。IR闪烁，按遥控后回复。

### 3.5 TCP 客户端模式下--调试

配置远程IP/端口（例：192.168.0.12:5000）。发送指令同上。

### 3.6 UDP 模式下--调试

UDP服务器：回复发送方。UDP客户端：回复远程。示例同TCP。

### 3.7 MQTT 模式下--调试

配置软件：MQTT 对接软件。助手：MQTTBox。  

#### 3.7.1 IP 配置方式

- 域名或IP配置服务器。  

#### 3.7.2 MQTT 参数配置

勾选配置；上传格式（带/不带ID）；用户名、密码、发布/订阅主题、设备ID。  

#### 3.7.3 配置示例

服务器test.mosquitto.org，主题自定义。

#### 3.7.4 测试平台测试

MQTTBox订阅/发布，验证数据（例：上报C01:7.85）。

## 四、通信协议详解

### 4.1 设备上传或回复数据格式

JSON，前缀1（上传）或4（回复）。  
例：1{"T01":10,"C01":7.85,"C02":7.66,"C03":7.62,"C04":7.47,"C11":12.0,"C51":18.0,"irout0s":"010600180001C80D","res":"123"}  

- T01：间隔(S)  
- C01-C04：模拟量  
- irout0s：红外回复  
- res：标识（<20字符，下发必带）  

### 4.2 下发数据格式

JSON，无空格。  
- 红外：{"irout0h":"内容","res":"123"}（0h四路，1h-4h单路）。  
- 读取模拟：{"readsta":0,"res":"123"}。  
- 间隔：{"uptime":0010,"res":"123"}。  

### 4.3 红外操作指令示例

- 对码：{"irout0h":"01060010000149CF","res":"123"}  
- 开关：开{"irout0h":"01060025000159C1","res":"123"}  
- 调温：18℃{"irout0h":"010600260002E9C0","res":"123"}  
- 学习：{"irout0h":"010600160001A9CE","res":"123"}  
- 发送：{"irout0h":"010600180001C80D","res":"123"}  
- 状态：{"irout0h":"01030025000195C1","res":"123"}  

软件生成指令：点击按钮复制日志。

### 4.4 Modbus-RTU 协议概述

默认地址1，9600bps。支持03H读、06H写单、10H写多。CRC16校验。  

### 4.5 功能码寄存器表

详见协议表（0000H-1180H）。例：版本0000H、匹配0010H、学习0016H。  

### 4.6 附件：设备对应关系、品牌代码号、按键表

- 对应：空调00、电视01、机顶盒02。  
- 代码号：Excel提供。  
- 按键：静音00、电源0D等。  

## 五、软件开发指南与代码示例

### 5.1 开发环境准备

- 语言：Python/C#/Java（推荐Python）。  
- 库：socket（TCP/UDP）、paho-mqtt（MQTT）、pymodbus（Modbus）。  
- 工具：配置软件、调试助手、MQTTBox。  

### 5.2 网络通信实现（TCP/UDP/MQTT）

TCP客户端示例（Python）：  
```python
import socket
import json

def send_command(ip, port, command):
    sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    sock.connect((ip, port))
    sock.send(json.dumps(command).encode('utf-8'))
    response = sock.recv(1024).decode('utf-8')
    sock.close()
    return response

# 示例：红外学习
cmd = {"irout0h": "010600160001A9CE", "res": "123"}
resp = send_command('192.168.0.100', 5000, cmd)
print(resp)
```

UDP示例类似，使用SOCK_DGRAM。  
MQTT：使用paho-mqtt订阅/发布主题。

### 5.3 红外控制代码示例（Python）

空调控制：  
```python
# 开机
cmd_open = {"irout0h": "01060025000159C1", "res": "456"}
# 调温18℃
cmd_temp = {"irout0h": "010600260002E9C0", "res": "456"}
# 发送函数如上
```

学习与测试：  
```python
# 学习键值1
cmd_learn = {"irout0h": "010600160001A9CE", "res": "123"}
# 测试
cmd_test = {"irout0h": "010600180001C80D", "res": "123"}
```

### 5.4 Modbus 集成示例

使用pymodbus：  
```python
from pymodbus.client import ModbusSerialClient

client = ModbusSerialClient(port='/dev/ttyUSB0', baudrate=9600)
client.connect()

# 读版本（地址0000H）
result = client.read_holding_registers(0, 1, slave=1)
print(result.registers[0])

# 写空调匹配（0010H=0001）
client.write_register(0x0010, 0x0001, slave=1)
client.close()
```

### 5.5 错误处理与调试

- 错误码：8003超时、8002完成。  
- 日志：捕获res不匹配或CRC错误。  
- 测试：先用助手验证，再集成。

## 六、开发注意事项与工具

- 注意：指令无空格；res一致；学习64通道；阈值10mV单位。  
- 工具：配置/调试软件（手册链接）；无互联网安装包。  
- 建议：Modbus控制状态；MQTT云端；测试网口灯正常。  
- 支持：xAI API见https://x.ai/api；无价格信息。  

