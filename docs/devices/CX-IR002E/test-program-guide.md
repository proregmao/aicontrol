# CX-IR002E 红外控制器测试程序使用指南

**版本：V1.0**  
**日期：2025-09-11**  
**说明：本文档详细说明CX-IR002E红外控制器测试程序的使用方法和功能特性**

## 📋 **程序概述**

本测试程序套件专为CX-IR002E工业级红外控制器设计，提供完整的设备测试、红外学习、空调控制和监控功能。

### **程序文件结构**
```
docs/CX-IR002E/
├── cx-ir002e-controller.js      # 核心控制器类
├── cx-ir002e-test.js            # 主测试程序
├── air-conditioner-test.js      # 空调控制专项测试
├── infrared-learning-test.js    # 红外学习专项测试
└── test-program-guide.md        # 使用指南 (本文档)
```

## 🔧 **设备规格**

### **CX-IR002E 技术参数**
- **供电电压**: DC 9-26V
- **工作温度**: -40°C ~ +80°C
- **通信接口**: 以太网 + RS485
- **红外输出**: 4路独立输出 (OUT1-OUT4)
- **红外接收**: 1路学习接收 (IR-IN)
- **模拟量采集**: 4路 (C01-C04)
- **通信协议**: TCP/UDP/MQTT + Modbus-RTU

### **网络配置**
- **默认IP**: 192.168.110.51
- **默认端口**: 50000
- **通信模式**: TCP多链接服务器
- **数据格式**: JSON
- **MAC地址**: B2B63296

## 🚀 **快速开始**

### **1. 基础连接测试**
```bash
# 快速连接测试 (默认配置)
node cx-ir002e-test.js

# 指定IP和端口
node cx-ir002e-test.js 192.168.110.51 50000 tcp quick

# UDP模式测试
node cx-ir002e-test.js 192.168.110.51 50000 udp quick
```

### **2. 完整功能测试**
```bash
# 完整功能测试
node cx-ir002e-test.js 192.168.0.100 5000 tcp full

# 实时监控模式 (5分钟，10秒间隔)
node cx-ir002e-test.js 192.168.0.100 5000 tcp monitor 300 10
```

### **3. 空调控制测试**
```bash
# 综合空调控制测试
node air-conditioner-test.js 192.168.0.100 5000 tcp comprehensive 格力

# 温度控制专项测试
node air-conditioner-test.js 192.168.0.100 5000 tcp temp 美的

# 查看支持的品牌
node air-conditioner-test.js 192.168.0.100 5000 tcp brands
```

### **4. 红外学习测试**
```bash
# 单次红外学习 (30秒学习时间)
node infrared-learning-test.js 192.168.0.100 5000 tcp single 30 "电源键" 0

# 空调遥控器完整学习
node infrared-learning-test.js 192.168.0.100 5000 tcp airconditioner 45

# 自定义遥控器学习
node infrared-learning-test.js 192.168.0.100 5000 tcp custom 30 "音量+" "音量-" "静音"
```

## 🧪 **测试模式详解**

### **主测试程序 (cx-ir002e-test.js)**

#### **quick - 快速连接测试**
```bash
node cx-ir002e-test.js [IP] [端口] [模式] quick
```
- ✅ 设备连接验证
- ✅ 设备信息读取
- ✅ 模拟量数据读取
- ⏱️ 执行时间: ~10-15秒

#### **full - 完整功能测试**
```bash
node cx-ir002e-test.js [IP] [端口] [模式] full
```
- ✅ 基础连接测试
- ✅ 设备信息测试
- ✅ 模拟量数据测试
- ✅ 上传间隔设置
- ✅ 红外学习功能
- ✅ 红外发射功能
- ✅ 品牌匹配功能
- ⏱️ 执行时间: ~2-3分钟

#### **learn - 红外学习模式**
```bash
node cx-ir002e-test.js [IP] [端口] [模式] learn [学习时间秒]
```
- ✅ 启动红外学习模式
- ✅ 倒计时显示
- ✅ 学习结果验证
- ✅ 发射测试

#### **control - 空调控制测试**
```bash
node cx-ir002e-test.js [IP] [端口] [模式] control [品牌] [温度]
```
- ✅ 品牌匹配
- ✅ 开关机控制
- ✅ 温度调节
- ✅ 模式切换
- ✅ 风速调节

#### **monitor - 实时监控模式**
```bash
node cx-ir002e-test.js [IP] [端口] [模式] monitor [持续秒] [间隔秒]
```
- ✅ 实时数据采集
- ✅ 趋势分析
- ✅ 数据记录
- ✅ 监控报告生成

### **空调控制专项测试 (air-conditioner-test.js)**

#### **comprehensive - 综合空调测试**
```bash
node air-conditioner-test.js [IP] [端口] [模式] comprehensive [品牌]
```
- ✅ 设备连接测试
- ✅ 品牌匹配测试
- ✅ 开关机测试
- ✅ 温度控制测试
- ✅ 模式切换测试
- ✅ 风速控制测试

#### **专项功能测试**
```bash
# 品牌匹配测试
node air-conditioner-test.js [IP] [端口] [模式] brand

# 温度控制测试
node air-conditioner-test.js [IP] [端口] [模式] temp [品牌]

# 模式切换测试
node air-conditioner-test.js [IP] [端口] [模式] mode [品牌]

# 风速控制测试
node air-conditioner-test.js [IP] [端口] [模式] fan [品牌]

# 开关机测试
node air-conditioner-test.js [IP] [端口] [模式] power [品牌] [循环次数]
```

### **红外学习专项测试 (infrared-learning-test.js)**

#### **single - 单次学习**
```bash
node infrared-learning-test.js [IP] [端口] [模式] single [学习时间] [命令名] [通道]
```
- ✅ 单个按键学习
- ✅ 学习结果验证
- ✅ 发射测试

#### **airconditioner - 空调遥控器学习**
```bash
node infrared-learning-test.js [IP] [端口] [模式] airconditioner [学习时间]
```
- ✅ 开关机学习
- ✅ 制冷/制热/除湿模式学习
- ✅ 温度调节学习
- ✅ 风速/摆风学习

#### **custom - 自定义学习**
```bash
node infrared-learning-test.js [IP] [端口] [模式] custom [学习时间] [命令1] [命令2] ...
```
- ✅ 自定义命令学习
- ✅ 批量学习处理
- ✅ 学习质量评估

#### **comprehensive - 综合学习测试**
```bash
node infrared-learning-test.js [IP] [端口] [模式] comprehensive
```
- ✅ 单次学习测试
- ✅ 批量学习测试
- ✅ 学习结果验证
- ✅ 学习质量评估

## 📊 **支持的空调品牌**

### **主要品牌代码表**
| 品牌 | 代码 | 品牌 | 代码 |
|------|------|------|------|
| 格力 | 0x006E | 美的 | 0x00A5 |
| 海尔 | 0x0089 | 奥克斯 | 0x004F |
| 海信 | 0x008B | 长虹 | 0x0052 |
| 春兰 | 0x0050 | 志高 | 0x00C1 |
| 三菱 | 0x00A9 | 松下 | 0x00A6 |
| 大金 | 0x006D | 东芝 | 0x006F |
| 三星 | 0x00AB | LG | 0x008A |

### **查看完整品牌列表**
```bash
node cx-ir002e-test.js 192.168.0.100 5000 tcp brands
node air-conditioner-test.js 192.168.0.100 5000 tcp brands
```

## 📈 **输出示例**

### **快速连接测试输出**
```
⚡ CX-IR002E 快速连接测试
设备: 192.168.0.100:5000 (TCP)
==================================================

🔍 设备连接测试...
📡 TCP连接成功: 192.168.0.100:5000
📤 发送指令 (尝试 1/3): {"readsta":0,"res":"conn_test"}
📥 收到响应: 4{"T01":30,"C01":7.85,"C02":7.66,"res":"conn_test"}
✅ 设备连接成功

📋 设备信息读取...
✅ 设备信息读取成功

📊 模拟量数据读取...
📊 模拟量数据:
  C01: 7.85V
  C02: 7.66V
  C03: 7.62V
  C04: 7.47V
✅ 模拟量数据读取成功

📊 快速测试结果汇总:
------------------------------
  1. 设备连接: ✅
  2. 设备信息: ✅
  3. 模拟量读取: ✅

🎯 测试成功率: 3/3 (100%)
🎉 快速连接测试全部通过！
```

### **空调控制测试输出**
```
🏠 空调品牌匹配: 格力
📋 品牌代码: 0x006E
📡 TCP连接成功: 192.168.0.100:5000
📤 发送指令 (尝试 1/3): {"irout0h":"01060010006E49CF","res":"brand_match"}
📥 收到响应: 4{"irout0s":"01060010006E49CF","res":"brand_match"}
✅ 格力 品牌匹配成功

🔌 空调电源控制: toggle
📤 发送指令 (尝试 1/3): {"irout0h":"01060025000159C1","res":"power_control"}
✅ 空调电源控制成功

🌡️ 设置空调温度: 24°C
📋 温度代码: 8 (24°C)
📤 发送指令 (尝试 1/3): {"irout0h":"01060026000829C0","res":"temp_control"}
✅ 空调温度设置成功: 24°C
```

### **红外学习测试输出**
```
🎓 单次红外学习测试
通道: 0, 学习时间: 30秒, 命令: 电源键
==================================================

📡 启动红外学习模式...
📤 发送指令 (尝试 1/3): {"irout0h":"010600160001A9CE","res":"ir_learn"}
✅ 红外学习模式启动成功

📋 学习操作指南:
  1. 将遥控器对准红外接收头
  2. 保持距离5-10cm
  3. 按下要学习的遥控器按键
  4. 观察设备IR指示灯状态
  5. 等待学习完成确认

⏰ 学习倒计时开始 (30秒):
⏰ 剩余时间: 29  

🧪 测试学习结果...
📤 发送指令 (尝试 1/3): {"irout0h":"010600180001C80D","res":"ir_send"}
✅ 红外学习和发射测试成功
💡 请观察目标设备是否有响应
```

## ⚠️ **注意事项**

### **硬件连接**
1. **电源**: 确保DC 9-26V供电稳定
2. **网络**: 网线连接正常，IP地址配置正确
3. **红外发射器**: 4路发射器正确连接到OUT1-OUT4
4. **红外接收器**: 学习接收器连接到IR-IN
5. **模拟量**: C01-C04模拟量输入连接正确

### **软件配置**
1. **网络设置**: 确保设备IP地址可访问
2. **防火墙**: 确保端口5000未被阻止
3. **Node.js**: 确保Node.js环境正确安装
4. **依赖包**: 确保所有依赖包已安装

### **测试环境**
1. **红外学习**: 在较暗环境中进行，避免强光干扰
2. **学习距离**: 遥控器距离红外接收头5-10cm
3. **学习时间**: 根据遥控器类型调整学习时间
4. **发射距离**: 红外发射器距离目标设备1-5米

## 🔧 **故障排除**

### **连接问题**
**现象**: 设备连接失败
**解决方案**:
1. 检查网络连接和IP地址
2. 确认设备电源正常
3. 检查防火墙设置
4. 尝试不同的通信模式 (TCP/UDP)

### **红外学习问题**
**现象**: 红外学习失败
**解决方案**:
1. 检查遥控器电池电量
2. 调整遥控器与接收头距离
3. 在较暗环境中进行学习
4. 增加学习时间
5. 检查红外接收器连接

### **空调控制问题**
**现象**: 空调无响应
**解决方案**:
1. 确认品牌匹配正确
2. 检查红外发射器安装位置
3. 调整发射器与空调距离
4. 尝试其他品牌代码
5. 使用红外学习功能

### **模拟量读取问题**
**现象**: 模拟量数据异常
**解决方案**:
1. 检查C01-C04接线
2. 确认输入信号范围
3. 检查设备接地
4. 验证信号源稳定性

## 📋 **最佳实践**

### **测试流程建议**
1. **基础测试**: 先执行quick模式验证连接
2. **功能测试**: 再执行full模式测试所有功能
3. **专项测试**: 根据需要执行专项测试
4. **实际验证**: 观察实际设备响应效果

### **红外学习建议**
1. **环境准备**: 选择较暗、无干扰的环境
2. **设备准备**: 确保遥控器电池充足
3. **操作规范**: 按键一次即可，不要连续按
4. **验证测试**: 学习后立即进行发射测试

### **空调控制建议**
1. **品牌匹配**: 优先尝试对应品牌代码
2. **功能测试**: 按开机→模式→温度→风速顺序测试
3. **效果观察**: 每个指令后观察空调实际响应
4. **备用方案**: 品牌代码无效时使用学习功能

## 🔄 **更新记录**

- **V1.0 (2025-09-11)**：初始版本，包含完整的测试程序和使用指南

---

**程序版本**: v1.0  
**更新日期**: 2025-09-11  
**适用设备**: CX-IR002E 工业级红外控制器  
**通信协议**: TCP/UDP/MQTT + Modbus-RTU
