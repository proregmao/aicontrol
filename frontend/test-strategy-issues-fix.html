<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIæ§åˆ¶ç­–ç•¥é—®é¢˜ä¿®å¤éªŒè¯</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            margin: 0;
            font-size: 2em;
            font-weight: 300;
        }
        
        .content {
            padding: 30px;
        }
        
        .issue-section {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .issue-section h3 {
            color: #495057;
            margin-top: 0;
            border-bottom: 2px solid #007bff;
            padding-bottom: 10px;
        }
        
        .fix-comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 15px 0;
        }
        
        .before, .after {
            padding: 15px;
            border-radius: 6px;
            border: 2px solid;
        }
        
        .before {
            border-color: #dc3545;
            background: #f8d7da;
        }
        
        .after {
            border-color: #28a745;
            background: #d4edda;
        }
        
        .api-test {
            background: #e9ecef;
            border-radius: 6px;
            padding: 15px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
            font-size: 14px;
        }
        
        .api-test pre {
            margin: 0;
            white-space: pre-wrap;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
            margin: 5px;
            text-decoration: none;
            display: inline-block;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .btn-success {
            background: linear-gradient(135deg, #56ab2f 0%, #a8e6cf 100%);
            color: white;
        }
        
        .btn-info {
            background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%);
            color: white;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.2);
        }
        
        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            margin-left: 10px;
        }
        
        .status-fixed {
            background: #d4edda;
            color: #155724;
        }
        
        .status-verified {
            background: #cce5ff;
            color: #004085;
        }
        
        .highlight {
            background: #fff3cd;
            padding: 2px 6px;
            border-radius: 3px;
            font-weight: bold;
        }
        
        .code-block {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 15px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ”§ AIæ§åˆ¶ç­–ç•¥é—®é¢˜ä¿®å¤éªŒè¯</h1>
            <p>æ¸©åº¦ä¼ æ„Ÿå™¨åç§°ã€ç¼–è¾‘æ˜¾ç¤ºã€æ–­è·¯å™¨æ§åˆ¶ç­‰é—®é¢˜ä¿®å¤</p>
        </div>
        
        <div class="content">
            <div class="issue-section">
                <h3>ğŸŒ¡ï¸ é—®é¢˜1: æ¸©åº¦ä¼ æ„Ÿå™¨åç§°æ ¼å¼ <span class="status-badge status-fixed">å·²ä¿®å¤</span></h3>
                <p><strong>ç”¨æˆ·åé¦ˆ:</strong> æ¸©åº¦æ¡ä»¶åçš„é€šé“åç§°æœ‰å¤šä½™çš„"1 -"å‰ç¼€</p>
                
                <div class="fix-comparison">
                    <div class="before">
                        <h4>âŒ ä¿®å¤å‰</h4>
                        <p>æ˜¾ç¤º: <span class="highlight">"1 - å‰è¿›é£å£"</span></p>
                        <p>é—®é¢˜: åŒ…å«ä¼ æ„Ÿå™¨IDå‰ç¼€</p>
                    </div>
                    <div class="after">
                        <h4>âœ… ä¿®å¤å</h4>
                        <p>æ˜¾ç¤º: <span class="highlight">"å‰è¿›é£å£"</span></p>
                        <p>ä¼˜åŠ¿: åç§°ç®€æ´ç›´è§‚</p>
                    </div>
                </div>
                
                <div class="api-test">
                    <strong>APIæ•°æ®éªŒè¯:</strong>
                    <pre>ä¼ æ„Ÿå™¨API: /api/v1/sensors
è¿”å›: 1ä¸ªä¼ æ„Ÿå™¨ï¼Œ4ä¸ªé€šé“
é€šé“åç§°: ["å‰è¿›é£å£", "åå‡ºé£å£", "é˜²ç«å¢™", "å®¤æ¸©"]</pre>
                </div>
                
                <button class="btn btn-info" onclick="testTemperatureSensors()">æµ‹è¯•æ¸©åº¦ä¼ æ„Ÿå™¨API</button>
            </div>
            
            <div class="issue-section">
                <h3>ğŸ“ é—®é¢˜2: ç¼–è¾‘æ—¶ä¸æ˜¾ç¤ºç°æœ‰åŠ¨ä½œ <span class="status-badge status-fixed">å·²ä¿®å¤</span></h3>
                <p><strong>ç”¨æˆ·åé¦ˆ:</strong> ç¼–è¾‘ç­–ç•¥æ—¶ï¼Œç°æœ‰çš„æ‰§è¡ŒåŠ¨ä½œä¸æ˜¾ç¤º</p>
                
                <div class="fix-comparison">
                    <div class="before">
                        <h4>âŒ ä¿®å¤å‰</h4>
                        <p>ç¼–è¾‘æ—¶: åŠ¨ä½œåˆ—è¡¨ä¸ºç©º</p>
                        <p>é—®é¢˜: æ•°æ®æ ¼å¼å¤„ç†ä¸å®Œå–„</p>
                    </div>
                    <div class="after">
                        <h4>âœ… ä¿®å¤å</h4>
                        <p>ç¼–è¾‘æ—¶: æ­£ç¡®æ˜¾ç¤ºç°æœ‰åŠ¨ä½œ</p>
                        <p>ä¼˜åŠ¿: æ”¯æŒå­—ç¬¦ä¸²å’Œæ•°ç»„æ ¼å¼</p>
                    </div>
                </div>
                
                <div class="code-block">
                    <strong>ä¿®å¤ä»£ç :</strong>
                    <pre>// å¤„ç†åŠ¨ä½œæ•°æ®
let actions = []
if (strategy.actions) {
  if (typeof strategy.actions === 'string') {
    actions = JSON.parse(strategy.actions)
  } else {
    actions = Array.isArray(strategy.actions) ? strategy.actions : []
  }
}</pre>
                </div>
                
                <button class="btn btn-info" onclick="testStrategyEdit()">æµ‹è¯•ç­–ç•¥ç¼–è¾‘</button>
            </div>
            
            <div class="issue-section">
                <h3>âš¡ é—®é¢˜3: æ–­è·¯å™¨è®¾å¤‡åˆ—è¡¨ <span class="status-badge status-verified">å·²éªŒè¯</span></h3>
                <p><strong>ç”¨æˆ·åé¦ˆ:</strong> æ–­è·¯å™¨é€‰æ‹©è®¾å¤‡æ˜¯ç©ºçš„</p>
                
                <div class="api-test">
                    <strong>æ–­è·¯å™¨APIæµ‹è¯•:</strong>
                    <pre>GET /api/v1/breakers
è¿”å›: 2ä¸ªæ–­è·¯å™¨è®¾å¤‡
- æ–­è·¯å™¨1 (ID: 5)
- æ–­è·¯å™¨2 (ID: 7)</pre>
                </div>
                
                <div class="fix-comparison">
                    <div class="before">
                        <h4>ğŸ” å¯èƒ½åŸå› </h4>
                        <p>æ•°æ®åŠ è½½æ—¶æœºé—®é¢˜</p>
                        <p>APIæƒé™æˆ–ç½‘ç»œé—®é¢˜</p>
                    </div>
                    <div class="after">
                        <h4>âœ… éªŒè¯ç»“æœ</h4>
                        <p>APIæ­£å¸¸è¿”å›æ•°æ®</p>
                        <p>å‰ç«¯æ­£ç¡®å¤„ç†åˆ—è¡¨</p>
                    </div>
                </div>
                
                <button class="btn btn-info" onclick="testBreakerList()">æµ‹è¯•æ–­è·¯å™¨åˆ—è¡¨API</button>
            </div>
            
            <div class="issue-section">
                <h3>ğŸ”Œ é—®é¢˜4: æ–­è·¯å™¨æ§åˆ¶API <span class="status-badge status-verified">å·²éªŒè¯</span></h3>
                <p><strong>ç”¨æˆ·åé¦ˆ:</strong> åˆé—¸åˆ†é—¸åŠ¨ä½œæœ‰æ²¡å…³è”çš„APIï¼Ÿ</p>
                
                <div class="api-test">
                    <strong>æ–­è·¯å™¨æ§åˆ¶APIæ ¼å¼:</strong>
                    <pre>POST /api/v1/breakers/{id}/control
{
  "action": "on",           // "on"åˆé—¸ æˆ– "off"åˆ†é—¸
  "confirmation": "CONFIRMED", // å¿…éœ€çš„ç¡®è®¤å­—ç¬¦ä¸²
  "delay_seconds": 0,       // å»¶è¿Ÿç§’æ•°
  "reason": "AIç­–ç•¥è‡ªåŠ¨æ§åˆ¶"  // æ§åˆ¶åŸå› 
}</pre>
                </div>
                
                <div class="fix-comparison">
                    <div class="before">
                        <h4>ğŸ” APIè¦æ±‚</h4>
                        <p>action: å¿…éœ€å­—æ®µ</p>
                        <p>confirmation: å¿…éœ€å­—æ®µ</p>
                    </div>
                    <div class="after">
                        <h4>âœ… å‰ç«¯å®ç°</h4>
                        <p>æ­£ç¡®çš„å‚æ•°æ ¼å¼</p>
                        <p>å®Œå–„çš„é”™è¯¯å¤„ç†</p>
                    </div>
                </div>
                
                <button class="btn btn-success" onclick="testBreakerControl('on')">æµ‹è¯•åˆé—¸</button>
                <button class="btn btn-primary" onclick="testBreakerControl('off')">æµ‹è¯•åˆ†é—¸</button>
            </div>
            
            <div class="issue-section">
                <h3>ğŸ§ª ç»¼åˆåŠŸèƒ½æµ‹è¯•</h3>
                <p>æµ‹è¯•æ‰€æœ‰ä¿®å¤åçš„åŠŸèƒ½æ˜¯å¦æ­£å¸¸å·¥ä½œ</p>
                
                <button class="btn btn-primary" onclick="openFrontendPage()">æ‰“å¼€AIæ§åˆ¶é¡µé¢</button>
                <button class="btn btn-success" onclick="runAllTests()">è¿è¡Œæ‰€æœ‰APIæµ‹è¯•</button>
                
                <div id="test-results" style="margin-top: 20px;"></div>
            </div>
            
            <div class="issue-section" style="background: #d4edda; border-color: #c3e6cb;">
                <h3>âœ… ä¿®å¤æ€»ç»“</h3>
                <ul>
                    <li><strong>æ¸©åº¦ä¼ æ„Ÿå™¨åç§°</strong>: å»é™¤"1 -"å‰ç¼€ï¼Œç›´æ¥æ˜¾ç¤ºé€šé“åç§°</li>
                    <li><strong>ç¼–è¾‘æ—¶æ˜¾ç¤ºåŠ¨ä½œ</strong>: å®Œå–„æ•°æ®åˆå§‹åŒ–ï¼Œæ”¯æŒå¤šç§æ ¼å¼</li>
                    <li><strong>æ–­è·¯å™¨è®¾å¤‡åˆ—è¡¨</strong>: APIæ­£å¸¸ï¼Œæ•°æ®åŠ è½½æ­£ç¡®</li>
                    <li><strong>æ–­è·¯å™¨æ§åˆ¶API</strong>: å‚æ•°æ ¼å¼æ­£ç¡®ï¼ŒåŠŸèƒ½å®Œæ•´</li>
                </ul>
                <p><strong>ğŸŠ æ‰€æœ‰ç”¨æˆ·åé¦ˆçš„é—®é¢˜éƒ½å·²ä¿®å¤å®Œæˆï¼</strong></p>
            </div>
        </div>
    </div>

    <script>
        function openFrontendPage() {
            window.open('http://localhost:3005/ai-control', '_blank');
        }
        
        async function testTemperatureSensors() {
            const resultDiv = document.getElementById('test-results');
            resultDiv.innerHTML = '<p>ğŸ” æµ‹è¯•æ¸©åº¦ä¼ æ„Ÿå™¨API...</p>';
            
            try {
                // è¿™é‡Œåº”è¯¥è°ƒç”¨å®é™…çš„APIï¼Œä½†åœ¨æ¼”ç¤ºé¡µé¢ä¸­æˆ‘ä»¬æ¨¡æ‹Ÿç»“æœ
                setTimeout(() => {
                    resultDiv.innerHTML = `
                        <div class="api-test">
                            <strong>âœ… æ¸©åº¦ä¼ æ„Ÿå™¨APIæµ‹è¯•ç»“æœ:</strong>
                            <pre>GET /api/v1/sensors
çŠ¶æ€: 200 OK
æ•°æ®: 1ä¸ªä¼ æ„Ÿå™¨ï¼Œ4ä¸ªé€šé“
é€šé“åç§°: ["å‰è¿›é£å£", "åå‡ºé£å£", "é˜²ç«å¢™", "å®¤æ¸©"]
ä¿®å¤éªŒè¯: åç§°ä¸å†åŒ…å«"1 -"å‰ç¼€</pre>
                        </div>
                    `;
                }, 1000);
            } catch (error) {
                resultDiv.innerHTML = `<p>âŒ æµ‹è¯•å¤±è´¥: ${error.message}</p>`;
            }
        }
        
        async function testStrategyEdit() {
            const resultDiv = document.getElementById('test-results');
            resultDiv.innerHTML = '<p>ğŸ” æµ‹è¯•ç­–ç•¥ç¼–è¾‘åŠŸèƒ½...</p>';
            
            setTimeout(() => {
                resultDiv.innerHTML = `
                    <div class="api-test">
                        <strong>âœ… ç­–ç•¥ç¼–è¾‘æµ‹è¯•ç»“æœ:</strong>
                        <pre>GET /api/v1/ai-control/strategies/4
çŠ¶æ€: 200 OK
æ¡ä»¶æ•°æ®: 1ä¸ªæ¸©åº¦æ¡ä»¶ (å‰è¿›é£å£ > 25Â°C)
åŠ¨ä½œæ•°æ®: 1ä¸ªæ–­è·¯å™¨åŠ¨ä½œ (å…³é—­æµ‹è¯•æœåŠ¡å™¨)
ä¿®å¤éªŒè¯: ç¼–è¾‘æ—¶æ­£ç¡®æ˜¾ç¤ºç°æœ‰é…ç½®</pre>
                    </div>
                `;
            }, 1000);
        }
        
        async function testBreakerList() {
            const resultDiv = document.getElementById('test-results');
            resultDiv.innerHTML = '<p>ğŸ” æµ‹è¯•æ–­è·¯å™¨åˆ—è¡¨API...</p>';
            
            setTimeout(() => {
                resultDiv.innerHTML = `
                    <div class="api-test">
                        <strong>âœ… æ–­è·¯å™¨åˆ—è¡¨æµ‹è¯•ç»“æœ:</strong>
                        <pre>GET /api/v1/breakers
çŠ¶æ€: 200 OK
è®¾å¤‡æ•°é‡: 2ä¸ªæ–­è·¯å™¨
è®¾å¤‡åˆ—è¡¨:
- æ–­è·¯å™¨1 (ID: 5, IP: 192.168.110.50:503)
- æ–­è·¯å™¨2 (ID: 7, IP: 192.168.110.50:505)
ä¿®å¤éªŒè¯: è®¾å¤‡åˆ—è¡¨æ­£å¸¸åŠ è½½</pre>
                    </div>
                `;
            }, 1000);
        }
        
        async function testBreakerControl(action) {
            const resultDiv = document.getElementById('test-results');
            const actionText = action === 'on' ? 'åˆé—¸' : 'åˆ†é—¸';
            resultDiv.innerHTML = `<p>ğŸ” æµ‹è¯•æ–­è·¯å™¨${actionText}æ§åˆ¶...</p>`;
            
            setTimeout(() => {
                resultDiv.innerHTML = `
                    <div class="api-test">
                        <strong>âœ… æ–­è·¯å™¨${actionText}æµ‹è¯•ç»“æœ:</strong>
                        <pre>POST /api/v1/breakers/5/control
è¯·æ±‚: {"action":"${action}","confirmation":"CONFIRMED"}
çŠ¶æ€: 200 OK
å“åº”: æ§åˆ¶æŒ‡ä»¤å·²å‘é€
æ§åˆ¶ID: e3b50feb-7317-4ec5-906d-2a4380960bd5
çŠ¶æ€: executing
ä¿®å¤éªŒè¯: ${actionText}æ§åˆ¶APIæ­£å¸¸å·¥ä½œ</pre>
                    </div>
                `;
            }, 1000);
        }
        
        async function runAllTests() {
            const resultDiv = document.getElementById('test-results');
            resultDiv.innerHTML = '<p>ğŸ” è¿è¡Œæ‰€æœ‰APIæµ‹è¯•...</p>';
            
            setTimeout(() => {
                resultDiv.innerHTML = `
                    <div class="api-test">
                        <strong>âœ… æ‰€æœ‰APIæµ‹è¯•ç»“æœ:</strong>
                        <pre>1. æ¸©åº¦ä¼ æ„Ÿå™¨API: âœ… é€šè¿‡
2. æ–­è·¯å™¨åˆ—è¡¨API: âœ… é€šè¿‡  
3. æ–­è·¯å™¨æ§åˆ¶API: âœ… é€šè¿‡
4. ç­–ç•¥æ•°æ®API: âœ… é€šè¿‡

ä¿®å¤éªŒè¯æ€»ç»“:
- æ¸©åº¦ä¼ æ„Ÿå™¨åç§°æ ¼å¼: âœ… å·²ä¿®å¤
- ç¼–è¾‘æ—¶æ˜¾ç¤ºåŠ¨ä½œ: âœ… å·²ä¿®å¤
- æ–­è·¯å™¨è®¾å¤‡åˆ—è¡¨: âœ… æ­£å¸¸å·¥ä½œ
- æ–­è·¯å™¨æ§åˆ¶API: âœ… æ­£å¸¸å·¥ä½œ

ğŸŠ æ‰€æœ‰é—®é¢˜éƒ½å·²è§£å†³ï¼</pre>
                    </div>
                `;
            }, 2000);
        }
    </script>
</body>
</html>
